import{u as V,r as g,j as e,D as q,E as B,C as J,H as U}from"./index-CecK8F-0.js";import{d as K,S as u}from"./deduplication-CNSci7KQ.js";const h=d=>d.toISOString().split("T")[0],ee=()=>{const{orders:d,expenses:f,coworkingSessions:p}=V(),j=g.useMemo(()=>K(d),[d]),n=new Date,k=h(new Date(n.getFullYear(),n.getMonth(),1)),T=h(n),[r,y]=g.useState(k),[i,N]=g.useState(T),b=(s,t)=>{y(h(s)),N(h(t))},F=()=>{const s=new Date(n.getFullYear(),n.getMonth(),1),t=new Date(n.getFullYear(),n.getMonth()+1,0);b(s,t>n?n:t)},M=()=>{const s=new Date(n.getFullYear(),n.getMonth()-1,1),t=new Date(n.getFullYear(),n.getMonth(),0);b(s,t)},E=()=>{const s=new Date(n.getFullYear(),0,1);b(s,n)},{filteredOrders:R,filteredExpenses:$,filteredCoworkingSessions:Q,totalRevenue:O,totalExpensesAmount:_,netProfit:I,averageTicket:L,totalOrdersCount:W}=g.useMemo(()=>{const s=o=>{const a=new Date(o),C=a.getFullYear(),G=String(a.getMonth()+1).padStart(2,"0"),H=String(a.getDate()).padStart(2,"0");return`${C}-${G}-${H}`};console.log("ðŸ“… Date Range:",{startDate:r,endDate:i}),console.log("ðŸ“¦ Total orders (deduplicated):",j.length),console.log("ðŸ¢ Total coworking sessions:",p.length),d.length>0&&console.log("Sample order dates:",d.slice(0,3).map(o=>({date:o.date,localDate:s(o.date),total:o.total}))),p.length>0&&console.log("Sample coworking dates:",p.slice(0,3).map(o=>({endTime:o.endTime,localDate:o.endTime?s(o.endTime):null,total:o.total})));const t=j.filter(o=>{const a=s(o.date);return a>=r&&a<=i}),l=f.filter(o=>{const a=s(o.date);return a>=r&&a<=i}),x=p.filter(o=>{if(o.status!=="finished"||!o.endTime)return!1;const a=s(o.endTime);return a>=r&&a<=i});console.log("âœ… Filtered results:",{orders:t.length,coworking:x.length,expenses:l.length});const c=t.reduce((o,a)=>o+a.total,0),v=x.reduce((o,a)=>o+(a.total||0),0),m=c+v,S=l.reduce((o,a)=>o+a.amount,0),P=m-S,w=t.length+x.length,z=w>0?m/w:0;return{filteredOrders:t,filteredExpenses:l,filteredCoworkingSessions:x,totalRevenue:m,totalExpensesAmount:S,netProfit:P,averageTicket:z,totalOrdersCount:w}},[r,i,d,f,p]),D=(s,t)=>{if(s.length===0){alert("No hay datos para exportar en el periodo seleccionado.");return}const l=Object.keys(s[0]),x="data:text/csv;charset=utf-8,"+[l.join(","),...s.map(v=>l.map(m=>JSON.stringify(v[m])).join(","))].join(`
`),c=document.createElement("a");c.setAttribute("href",encodeURI(x)),c.setAttribute("download",t),document.body.appendChild(c),c.click(),document.body.removeChild(c)},Y=()=>{const s=R.flatMap(t=>t.items.map(l=>({order_id:t.id,order_date:t.date,client_name:t.clientName,payment_method:t.paymentMethod,product_id:l.id,product_name:l.name,quantity:l.quantity,price:l.price,cost:l.cost,item_total:l.price*l.quantity})));D(s,`ventas_${r}_a_${i}.csv`)},A=()=>{const s=$.map(t=>({expense_id:t.id,date:t.date,description:t.description,amount:t.amount,category:t.category,type:t.type}));D(s,`gastos_${r}_a_${i}.csv`)};return e.jsxs("div",{id:"report-content",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 mb-6",children:"Reportes Financieros"}),e.jsx("div",{className:"bg-white p-4 rounded-3xl shadow-md mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-grow min-w-[150px]",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Desde"}),e.jsx("input",{type:"date",value:r,onChange:s=>y(s.target.value),className:"w-full mt-1 border border-slate-300 rounded-xl p-2"})]}),e.jsxs("div",{className:"flex-grow min-w-[150px]",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Hasta"}),e.jsx("input",{type:"date",value:i,onChange:s=>N(s.target.value),className:"w-full mt-1 border border-slate-300 rounded-xl p-2"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-5",children:[e.jsx("button",{onClick:F,className:"px-3 py-2 text-sm bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Este Mes"}),e.jsx("button",{onClick:M,className:"px-3 py-2 text-sm bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Mes Pasado"}),e.jsx("button",{onClick:E,className:"px-3 py-2 text-sm bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Este AÃ±o"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsx(u,{title:"Ingresos Totales",value:`$${O.toFixed(2)}`,icon:e.jsx(q,{className:"h-6 w-6 text-green-600"})}),e.jsx(u,{title:"Gastos Totales",value:`$${_.toFixed(2)}`,icon:e.jsx(B,{className:"h-6 w-6 text-red-600"})}),e.jsx(u,{title:"Ganancia Neta",value:`$${I.toFixed(2)}`,icon:e.jsx(J,{className:"h-6 w-6 text-indigo-600"})}),e.jsx(u,{title:"Ticket Promedio",value:`$${L.toFixed(2)}`,icon:e.jsx(U,{className:"h-6 w-6 text-yellow-600"})})]}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Nota:"})," Los gastos totales incluyen todos los costos operativos (mercancÃ­a, renta, servicios, salarios, etc.). La ganancia neta se calcula como: Ingresos - Gastos Totales. Los costos de mercancÃ­a no se suman por separado para evitar duplicaciÃ³n."]})})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-3xl shadow-md mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800 mb-3",children:"Exportar Datos"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("button",{onClick:()=>window.print(),className:"px-4 py-2 bg-zinc-900 text-white rounded-xl hover:bg-zinc-800 transition-colors",children:"Imprimir / Guardar PDF"}),e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-green-700 text-white rounded-xl hover:bg-green-600 transition-colors",children:"Descargar Ventas (CSV)"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-red-700 text-white rounded-xl hover:bg-red-600 transition-colors",children:"Descargar Gastos (CSV)"})]})]}),e.jsx("style",{children:`
                @media print {
                    body {
                        padding-bottom: 0 !important;
                    }
                    body * {
                        visibility: hidden;
                    }
                    nav {
                        display: none !important;
                    }
                    #report-content, #report-content * {
                        visibility: visible;
                    }
                    #report-content {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                        padding: 1rem;
                    }
                    .shadow-md {
                        box-shadow: none !important;
                    }
                    .bg-white {
                        border: 1px solid #eee;
                    }
                }
            `})]})};export{ee as default};
