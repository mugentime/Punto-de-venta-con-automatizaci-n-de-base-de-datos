import{r,j as e,u as y,R as F,T as P}from"./index-CecK8F-0.js";const T=({message:s,productName:o,onClose:c,duration:x=2e3})=>(r.useEffect(()=>{const i=setTimeout(()=>{c()},x);return()=>clearTimeout(i)},[c,x]),e.jsx("div",{className:"fixed top-4 right-4 z-50 animate-slide-in-right",children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg flex items-center space-x-3 min-w-[280px]",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:s}),o&&e.jsx("p",{className:"text-xs opacity-90 mt-1",children:o})]})]})})),$=({product:s,onClick:o})=>e.jsxs("button",{onClick:o,className:"bg-white rounded-xl sm:rounded-2xl shadow-md overflow-hidden cursor-pointer hover:shadow-lg active:shadow-xl transition-shadow duration-200 group flex flex-col h-full text-left w-full min-h-[44px] touch-manipulation","aria-label":`Agregar ${s.name} al carrito`,children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"h-28 sm:h-32 md:h-40 w-full object-cover"}),e.jsxs("div",{className:"p-2 sm:p-3 flex-1 flex flex-col justify-between",children:[e.jsx("h3",{className:"text-sm sm:text-sm font-semibold text-slate-800 line-clamp-2 group-hover:text-zinc-700",children:s.name}),e.jsxs("p",{className:"text-base sm:text-lg font-bold text-slate-900 mt-1",children:["$",s.price.toFixed(2)]})]})]}),E=({item:s})=>{const{updateCartQuantity:o,removeFromCart:c}=y();return e.jsxs("div",{className:"flex items-center justify-between py-3 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["$",s.price.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>o(s.id,Math.max(1,s.quantity-1)),className:"min-w-[44px] min-h-[44px] w-10 h-10 sm:w-8 sm:h-8 flex items-center justify-center bg-slate-100 hover:bg-slate-200 active:bg-slate-300 rounded-lg font-bold text-slate-700 transition-colors touch-manipulation","aria-label":"Disminuir cantidad",children:"−"}),e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",value:s.quantity,onChange:x=>{const i=parseInt(x.target.value);!isNaN(i)&&i>=1&&o(s.id,i)},className:"w-12 sm:w-14 text-center border-slate-300 rounded-lg shadow-sm py-2 sm:py-1 text-base sm:text-sm focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500",style:{fontSize:"16px"},min:"1"}),e.jsx("button",{onClick:()=>o(s.id,s.quantity+1),className:"min-w-[44px] min-h-[44px] w-10 h-10 sm:w-8 sm:h-8 flex items-center justify-center bg-slate-100 hover:bg-slate-200 active:bg-slate-300 rounded-lg font-bold text-slate-700 transition-colors touch-manipulation","aria-label":"Aumentar cantidad",children:"+"})]}),e.jsxs("p",{className:"w-16 sm:w-20 text-right font-medium text-sm text-slate-900",children:["$",(s.price*s.quantity).toFixed(2)]}),e.jsx("button",{onClick:()=>c(s.id),className:"min-w-[44px] min-h-[44px] p-2 sm:p-1 text-slate-500 hover:text-red-600 active:text-red-700 rounded-full transition-colors touch-manipulation","aria-label":"Eliminar del carrito",children:e.jsx(P,{className:"h-5 w-5 sm:h-4 sm:w-4"})})]})},I=()=>{const{cart:s,cartTotal:o,createOrder:c,clearCart:x,customers:i}=y(),[m,g]=r.useState(""),[f,p]=r.useState(""),[h,j]=r.useState("Mesa"),[t,d]=r.useState("Efectivo"),[n,C]=r.useState(0),[u,v]=r.useState(!1),[N,k]=r.useState(!1),a=i.find(l=>l.id===m),w=a?o*a.discountPercentage/100:0,b=o-w+n,z=async()=>{if(s.length===0)return;if(!u){v(!0);return}if(N){console.log("⚠️ Order already being processed, ignoring duplicate click");return}const l=m==="other"?f:(a==null?void 0:a.name)||"Cliente",M=a?a.id:void 0;k(!0);try{await c({clientName:l,serviceType:h,paymentMethod:t,customerId:M,tip:n}),v(!1),g(""),p(""),j("Mesa"),d("Efectivo"),C(0)}catch(L){console.error("Checkout failed:",L),v(!1)}finally{k(!1)}},S=()=>{v(!1)};return e.jsxs("div",{className:`bg-white rounded-xl sm:rounded-3xl shadow-md flex flex-col ${u?"h-[calc(100vh-8rem)]":"h-64"} sm:h-80 lg:h-full transition-all duration-300`,children:[e.jsx("div",{className:"p-3 sm:p-4 border-b flex-shrink-0",children:e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-slate-800",children:"Orden Actual"})}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 sm:p-4 overscroll-contain ${u?"hidden sm:block":""}`,children:s.length>0?s.map(l=>e.jsx(E,{item:l},l.id)):e.jsx("p",{className:"text-center text-slate-500 mt-8",children:"El carrito está vacío."})}),u&&e.jsxs("div",{className:"flex-1 p-3 sm:p-4 border-t overflow-y-auto overscroll-contain",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-700 mb-3 sm:mb-3",children:"Detalles de la Orden"}),e.jsxs("div",{className:"space-y-3 sm:space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customerSelect",className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),e.jsxs("select",{name:"customerSelect",id:"customerSelect",value:m,onChange:l=>{g(l.target.value),l.target.value!=="other"&&p("")},className:"min-h-[52px] block w-full border-2 border-slate-300 rounded-xl shadow-sm py-3 px-4 text-base focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 touch-manipulation bg-white",style:{fontSize:"16px"},children:[e.jsx("option",{value:"",children:"Seleccionar cliente..."}),i.map(l=>e.jsxs("option",{value:l.id,children:[l.name," ",l.discountPercentage>0?`(${l.discountPercentage}% desc.)`:""]},l.id)),e.jsx("option",{value:"other",children:"Otro (nombre personalizado)"})]})]}),m==="other"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customClientName",className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Cliente"}),e.jsx("input",{type:"text",name:"customClientName",id:"customClientName",value:f,onChange:l=>p(l.target.value),className:"min-h-[52px] block w-full border-2 border-slate-300 rounded-xl shadow-sm py-3 px-4 text-base focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 touch-manipulation bg-white",style:{fontSize:"16px"},placeholder:"Escribe el nombre..."})]}),a&&a.discountPercentage>0&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsxs("p",{className:"text-xs text-green-700",children:[e.jsx("span",{className:"font-semibold",children:"Descuento aplicado:"})," ",a.discountPercentage,"% (-$",w.toFixed(2),")"]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"serviceType",className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Servicio"}),e.jsxs("select",{name:"serviceType",id:"serviceType",value:h,onChange:l=>j(l.target.value),className:"min-h-[52px] block w-full border-2 border-slate-300 rounded-xl shadow-sm py-3 px-4 text-base focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 touch-manipulation bg-white",style:{fontSize:"16px"},children:[e.jsx("option",{children:"Mesa"}),e.jsx("option",{children:"Para llevar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"paymentMethod",className:"block text-sm font-medium text-slate-700 mb-2",children:"Método de Pago"}),e.jsxs("select",{name:"paymentMethod",id:"paymentMethod",value:t,onChange:l=>d(l.target.value),className:"min-h-[52px] block w-full border-2 border-slate-300 rounded-xl shadow-sm py-3 px-4 text-base focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 touch-manipulation bg-white",style:{fontSize:"16px"},children:[e.jsx("option",{children:"Efectivo"}),e.jsx("option",{children:"Tarjeta"}),a&&e.jsx("option",{children:"Crédito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tipAmount",className:"block text-sm font-medium text-slate-700 mb-2",children:"Propina (opcional)"}),e.jsx("input",{type:"number",inputMode:"decimal",name:"tipAmount",id:"tipAmount",value:n,onChange:l=>C(parseFloat(l.target.value)||0),className:"min-h-[52px] block w-full border-2 border-slate-300 rounded-xl shadow-sm py-3 px-4 text-base focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 touch-manipulation bg-white",style:{fontSize:"16px"},placeholder:"0.00",min:"0",step:"0.01"})]}),t==="Crédito"&&a&&e.jsxs("div",{className:`border rounded-lg p-2 ${a.currentCredit+b>a.creditLimit?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Crédito actual:"})," $",a.currentCredit.toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Nuevo crédito:"})," $",(a.currentCredit+b).toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Límite:"})," $",a.creditLimit.toFixed(2)]}),a.currentCredit+b>a.creditLimit&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-1",children:"⚠️ Excede el límite de crédito"})]})]})]}),e.jsxs("div",{className:"p-3 sm:p-4 pb-6 lg:pb-4 border-t bg-slate-50 rounded-b-3xl",children:[e.jsxs("div",{className:"space-y-2 text-sm mb-4",children:[w>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-600",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["Descuento (",a==null?void 0:a.discountPercentage,"%):"]}),e.jsxs("span",{children:["-$",w.toFixed(2)]})]})]}),n>0&&e.jsxs("div",{className:"flex justify-between text-sm text-slate-600",children:[e.jsx("span",{children:"Propina:"}),e.jsxs("span",{children:["+$",n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{className:"text-slate-900",children:"Total:"}),e.jsxs("span",{children:["$",b.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:u?S:x,disabled:N,className:"min-h-[44px] flex-1 py-3 px-3 sm:px-4 bg-white border border-slate-300 rounded-xl text-base sm:text-sm font-semibold text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",style:{fontSize:"16px"},children:u?"Cancelar":"Limpiar"}),e.jsx("button",{onClick:z,disabled:s.length===0||N,className:"min-h-[44px] flex-1 py-3 px-3 sm:px-4 bg-zinc-900 rounded-xl text-base sm:text-sm font-semibold text-white hover:bg-zinc-800 active:bg-zinc-700 transition-colors disabled:bg-zinc-400 disabled:cursor-not-allowed touch-manipulation",style:{fontSize:"16px"},children:N?"⏳ Procesando...":u?`Pagar $${b.toFixed(2)}`:"Cobrar"})]})]})]})},O=()=>{const{products:s,addToCart:o}=y(),[c,x]=r.useState(null),[i,m]=r.useState(""),[g,f]=r.useState(!1);F.useEffect(()=>{const t=()=>{f(window.innerWidth<1024)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const p=t=>{o(t),x({message:"Agregado al carrito",productName:t.name})},h=s.filter(t=>{var d,n;return t.name.toLowerCase().includes(i.toLowerCase())||((d=t.description)==null?void 0:d.toLowerCase().includes(i.toLowerCase()))||((n=t.category)==null?void 0:n.toLowerCase().includes(i.toLowerCase()))}),j=h.reduce((t,d)=>{const n=d.category||"Sin categoría";return t[n]||(t[n]=[]),t[n].push(d),t},{});return e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-3 lg:gap-6 h-full",children:[c&&e.jsx(T,{message:c.message,productName:c.productName,onClose:()=>x(null)}),e.jsxs("div",{className:"flex-1 lg:col-span-2 lg:overflow-y-auto lg:pr-2 min-h-0",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 mb-3 sm:mb-4",children:"Punto de Venta"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",inputMode:"search",placeholder:"Buscar productos...",value:i,onChange:t=>m(t.target.value),className:"w-full pl-10 sm:pl-12 pr-12 py-3 sm:py-3 border border-slate-300 rounded-xl sm:rounded-2xl shadow-sm focus:ring-2 focus:ring-zinc-500 focus:border-zinc-500 text-base transition-all",style:{fontSize:"16px"},autoFocus:!g}),i&&e.jsx("button",{onClick:()=>m(""),className:"absolute inset-y-0 right-0 pr-3 sm:pr-4 flex items-center text-slate-400 hover:text-slate-600 active:text-slate-800 min-w-[44px] min-h-[44px] touch-manipulation","aria-label":"Limpiar búsqueda",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i&&e.jsxs("p",{className:"mt-2 text-xs sm:text-sm text-slate-500",children:[h.length," ",h.length===1?"producto encontrado":"productos encontrados"]})]}),h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-slate-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-slate-500 text-lg font-medium",children:"No se encontraron productos"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Intenta con otro término de búsqueda"})]}):Object.entries(j).map(([t,d])=>e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-slate-700 mb-3 sm:mb-4 border-b pb-2",children:t}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 sm:gap-3 md:gap-4",children:d.map(n=>e.jsx($,{product:n,onClick:()=>p(n)},n.id))})]},t))]}),e.jsx("div",{className:"flex-shrink-0 mt-4 lg:mt-0 lg:col-span-1 lg:h-full",children:e.jsx(I,{})})]})};export{O as default};
