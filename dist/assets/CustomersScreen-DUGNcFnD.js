import{r as d,j as e,u as A,b as E,R as z,c as w,T as k}from"./index-CecK8F-0.js";const O=({isOpen:m,onClose:h,onSave:l,customerToEdit:n})=>{const[s,c]=d.useState({name:"",email:"",phone:"",discountPercentage:0,creditLimit:0});d.useEffect(()=>{c(n?{name:n.name,email:n.email||"",phone:n.phone||"",discountPercentage:n.discountPercentage,creditLimit:n.creditLimit}:{name:"",email:"",phone:"",discountPercentage:0,creditLimit:0})},[n,m]);const i=o=>{const{name:x,value:p}=o.target;c(r=>({...r,[x]:x==="discountPercentage"||x==="creditLimit"?parseFloat(p)||0:p}))},u=o=>{if(o.preventDefault(),!s.name.trim()){alert("El nombre del cliente es obligatorio.");return}if(s.discountPercentage<0||s.discountPercentage>100){alert("El descuento debe estar entre 0% y 100%.");return}l(n?{...n,...s}:s),h()};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:n?"Editar Cliente":"Nuevo Cliente Frecuente"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descuento (%)"}),e.jsx("input",{type:"number",name:"discountPercentage",value:s.discountPercentage,onChange:i,min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Límite de Crédito ($)"}),e.jsx("input",{type:"number",name:"creditLimit",value:s.creditLimit,onChange:i,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:h,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:n?"Actualizar":"Crear"})]})]})]})})}):null},I=({isOpen:m,onClose:h,customer:l,onAddCredit:n})=>{const[s,c]=d.useState("charge"),[i,u]=d.useState(0),[o,x]=d.useState(""),p=r=>{if(r.preventDefault(),!!l){if(i<=0){alert("El monto debe ser mayor a 0.");return}if(!(s==="charge"&&l.creditLimit>0&&l.currentCredit+i>l.creditLimit&&!confirm(`El crédito excederá el límite ($${l.creditLimit}). ¿Desea continuar?`))){if(s==="payment"&&i>l.currentCredit){alert("El monto del pago no puede ser mayor al crédito actual.");return}n(l.id,i,s,o),u(0),x(""),c("charge"),h()}}};return!m||!l?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Gestionar Crédito - ",l.name]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-100 rounded-md",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Crédito actual: ",e.jsxs("span",{className:"font-bold text-red-600",children:["$",l.currentCredit.toFixed(2)]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Límite de crédito: ",e.jsxs("span",{className:"font-bold",children:["$",l.creditLimit.toFixed(2)]})]})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Movimiento"}),e.jsxs("select",{value:s,onChange:r=>c(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"charge",children:"Cargo (Fiado)"}),e.jsx("option",{value:"payment",children:"Pago"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto ($) *"}),e.jsx("input",{type:"number",value:i,onChange:r=>u(parseFloat(r.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:o,onChange:r=>x(r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Motivo del cargo o pago..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{u(0),x(""),c("charge"),h()},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:`flex-1 px-4 py-2 text-white rounded-md transition-colors ${s==="charge"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,children:s==="charge"?"Agregar Cargo":"Registrar Pago"})]})]})]})})})},q=()=>{const{customers:m,addCustomer:h,updateCustomer:l,deleteCustomer:n,addCustomerCredit:s}=A(),[c,i]=d.useState(!1),[u,o]=d.useState(!1),[x,p]=d.useState(null),[r,b]=d.useState(null),[g,S]=d.useState({}),[y,v]=d.useState(null),j=(t=null)=>{p(t),i(!0)},L=()=>{p(null),i(!1)},C=t=>{b(t),o(!0)},P=()=>{b(null),o(!1)},$=t=>{"id"in t?l(t):h(t)},F=(t,a,f,N)=>{s(t,a,f,N)},M=async t=>{try{const a=await fetch(`/api/customers/${t}/credits`);if(a.ok){const f=await a.json();S(N=>({...N,[t]:f}))}}catch(a){console.error("Error loading customer credits:",a)}},D=t=>{y===t?v(null):(v(t),g[t]||M(t))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"Clientes Frecuentes"}),e.jsxs("button",{onClick:()=>j(),className:"flex items-center px-4 py-2 bg-zinc-900 text-white rounded-xl shadow-sm hover:bg-zinc-800 transition-colors",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Nuevo Cliente"]})]}),e.jsx("div",{className:"bg-white shadow-md rounded-3xl overflow-hidden hidden md:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600",children:"Cliente"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600",children:"Contacto"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600",children:"Descuento"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600",children:"Límite Crédito"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600",children:"Crédito Actual"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-slate-600 text-center",children:"Acciones"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs(z.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-slate-50 cursor-pointer",onClick:()=>D(t.id),children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800",children:t.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ID: ",t.id]})]})}),e.jsxs("td",{className:"p-4 text-sm text-slate-500",children:[t.email&&e.jsx("div",{children:t.email}),t.phone&&e.jsx("div",{children:t.phone}),!t.email&&!t.phone&&e.jsx("span",{className:"text-gray-400",children:"-"})]}),e.jsxs("td",{className:"p-4 text-sm text-green-600 font-medium",children:[t.discountPercentage,"%"]}),e.jsxs("td",{className:"p-4 text-sm text-slate-800",children:["$",t.creditLimit.toFixed(2)]}),e.jsx("td",{className:"p-4 text-sm font-medium",children:e.jsxs("span",{className:t.currentCredit>0?"text-red-600":"text-green-600",children:["$",t.currentCredit.toFixed(2)]})}),e.jsx("td",{className:"p-4 text-center",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("button",{onClick:()=>C(t),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Crédito"}),e.jsx("button",{onClick:()=>j(t),className:"p-2 text-slate-500 hover:text-zinc-700 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(w,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{confirm(`¿Eliminar cliente ${t.name}?`)&&n(t.id)},className:"p-2 text-slate-500 hover:text-red-600 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(k,{className:"h-5 w-5"})})]})})]}),y===t.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Historial de Créditos"}),g[t.id]&&g[t.id].length>0?e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 text-left",children:"Fecha"}),e.jsx("th",{className:"p-2 text-left",children:"Tipo"}),e.jsx("th",{className:"p-2 text-left",children:"Monto"}),e.jsx("th",{className:"p-2 text-left",children:"Estado"}),e.jsx("th",{className:"p-2 text-left",children:"Descripción"})]})}),e.jsx("tbody",{children:g[t.id].map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded ${a.type==="charge"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:a.type==="charge"?"Cargo":"Pago"})}),e.jsxs("td",{className:"p-2 font-medium",children:["$",a.amount.toFixed(2)]}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded ${a.status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:a.status==="paid"?"Pagado":"Pendiente"})}),e.jsx("td",{className:"p-2",children:a.description||"-"})]},a.id))})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No hay historial de créditos"})]})})})]},t.id))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:hidden gap-4",children:m.map(t=>e.jsx("div",{className:"bg-white rounded-2xl shadow-md overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800",children:t.name}),e.jsx("p",{className:"text-xs text-slate-500",children:t.email||t.phone||"Sin contacto"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>C(t),className:"px-2 py-1 text-xs bg-blue-500 text-white rounded-md",children:"Crédito"}),e.jsx("button",{onClick:()=>j(t),className:"p-2 text-slate-500 hover:text-zinc-700",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{confirm(`¿Eliminar cliente ${t.name}?`)&&n(t.id)},className:"p-2 text-slate-500 hover:text-red-600",children:e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 bg-slate-50 p-3 rounded-lg text-center text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Descuento"}),e.jsxs("div",{className:"font-bold text-green-600",children:[t.discountPercentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Límite"}),e.jsxs("div",{className:"font-medium",children:["$",t.creditLimit.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Deuda"}),e.jsxs("div",{className:`font-bold ${t.currentCredit>0?"text-red-600":"text-green-600"}`,children:["$",t.currentCredit.toFixed(2)]})]})]})]})},t.id))}),e.jsx(O,{isOpen:c,onClose:L,onSave:$,customerToEdit:x}),e.jsx(I,{isOpen:u,onClose:P,customer:r,onAddCredit:F})]})};export{q as default};
