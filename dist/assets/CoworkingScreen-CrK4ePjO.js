import{u as H,r as h,j as e,b as k,T}from"./index-CecK8F-0.js";const z=n=>{n<0&&(n=0);const c=Math.floor(n/1e3),u=Math.floor(c/3600),d=Math.floor(c%3600/60),f=c%60;return`${u.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},D=(n,c)=>{const u=new Date(n),f=new Date(c).getTime()-u.getTime();let l=Math.max(0,Math.ceil(f/(1e3*60)));const x=l%30;x>0&&x<=5&&(l-=x);const j=l/60;let o=0;if(l>0)if(j>=3)o=180;else if(l<=60)o=58;else{const b=l-60;o=58+Math.ceil(b/30)*29}return{cost:o,minutes:l}},B=()=>{const{coworkingSessions:n,startCoworkingSession:c,products:u,updateCoworkingSession:d,finishCoworkingSession:f,cancelCoworkingSession:l,deleteCoworkingSession:x}=H(),[j,o]=h.useState(new Date),[b,m]=h.useState(!1),[g,w]=h.useState(""),[y,v]=h.useState(null),[a,N]=h.useState(null);h.useEffect(()=>{const t=setInterval(()=>o(new Date),1e3);return()=>clearInterval(t)},[]),h.useEffect(()=>{if(a){const t=n.find(s=>s.id===a.id);t&&N(t)}},[n,a==null?void 0:a.id]);const q=()=>{c(g),m(!1),w("")},M=t=>{if(!a)return;const s=a.consumedExtras.find(i=>i.id===t.id);let r;s?r=a.consumedExtras.map(i=>i.id===t.id?{...i,quantity:i.quantity+1}:i):r=[...a.consumedExtras,{...t,quantity:1}],d(a.id,{consumedExtras:r})},F=(t,s)=>{const r=t.consumedExtras.filter(i=>i.id!==s);d(t.id,{consumedExtras:r})},$=async t=>{if(confirm("¿Estás seguro de que quieres cancelar esta sesión? Esta acción no se puede deshacer."))try{await l(t)}catch(s){console.error("Failed to cancel session:",s)}},I=async t=>{confirm("¿Estás seguro de que quieres eliminar esta sesión? Esta acción no se puede deshacer.")&&await x(t)},S=n.filter(t=>t.status==="active").sort((t,s)=>new Date(t.startTime).getTime()-new Date(s.startTime).getTime()),E=n.filter(t=>t.status==="finished").sort((t,s)=>new Date(s.endTime||s.startTime).getTime()-new Date(t.endTime||t.startTime).getTime()).slice(0,10),A=u.filter(t=>t.category==="Refrigerador"||t.category==="Alimentos");return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"Coworking"}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center px-4 py-2 bg-zinc-900 text-white rounded-xl shadow-sm hover:bg-zinc-800 transition-colors",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),"Nueva Sesión"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Sesiones Activas"}),S.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(t=>e.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-md flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:t.clientName}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Inicio: ",new Date(t.startTime).toLocaleTimeString()]}),e.jsx("p",{className:"text-4xl font-mono font-bold text-zinc-900 my-4 text-center bg-gray-100 py-2 rounded-xl",children:z(j.getTime()-new Date(t.startTime).getTime())}),t.consumedExtras.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-600 mb-1",children:"Extras:"}),e.jsx("ul",{className:"text-xs space-y-1",children:t.consumedExtras.map(s=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[s.name," x",s.quantity]}),e.jsx("button",{onClick:()=>F(t,s.id),className:"p-0.5 text-slate-400 hover:text-red-500",children:e.jsx(T,{className:"h-3 w-3"})})]},s.id))})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>N(t),className:"flex-1 py-2 px-3 bg-slate-100 rounded-xl text-sm font-semibold text-slate-700 hover:bg-slate-200",children:"Extras"}),e.jsx("button",{onClick:()=>$(t.id),className:"flex-1 py-2 px-3 bg-red-500 rounded-xl text-sm font-semibold text-white hover:bg-red-600",children:"Cancelar"}),e.jsx("button",{onClick:()=>v(t),className:"flex-1 py-2 px-3 bg-green-500 rounded-xl text-sm font-semibold text-white hover:bg-green-600",children:"Finalizar"})]})]},t.id))}):e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No hay sesiones activas."})]}),e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Últimas Sesiones"}),E.length>0?e.jsx("div",{className:"space-y-3",children:E.map(t=>{const{cost:s,minutes:r}=D(t.startTime,t.endTime||new Date().toISOString()),i=t.consumedExtras.reduce((p,C)=>p+C.price*C.quantity,0),O=s+i;return e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-800",children:t.clientName}),e.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(t.startTime).toLocaleDateString()," - ",z(r*60*1e3)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-slate-800",children:["$",O.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r," min"]})]})]}),t.consumedExtras.length>0&&e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Extras: ",t.consumedExtras.map(p=>`${p.name} x${p.quantity}`).join(", ")]})]}),e.jsx("button",{onClick:()=>I(t.id),className:"ml-4 p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar sesión",children:e.jsx(T,{className:"h-5 w-5"})})]},t.id)})}):e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No hay sesiones completadas."})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Iniciar Sesión"}),e.jsx("input",{type:"text",value:g,onChange:t=>w(t.target.value),placeholder:"Nombre del Cliente (Opcional)",className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm mb-4"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-white border border-slate-300 rounded-xl text-sm font-medium text-slate-700",children:"Cancelar"}),e.jsx("button",{onClick:q,className:"px-4 py-2 bg-zinc-900 rounded-xl text-sm font-medium text-white",children:"Iniciar"})]})]})}),y&&e.jsx(P,{session:y,onClose:()=>v(null),onConfirm:f}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-md p-6 flex flex-col max-h-[90vh]",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:["Agregar Extras para ",a.clientName]}),a.consumedExtras.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-xl",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800 mb-2",children:"Extras Agregados:"}),e.jsx("div",{className:"space-y-1",children:a.consumedExtras.map(t=>e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"text-green-700",children:[t.name," x",t.quantity]}),e.jsxs("span",{className:"text-green-800 font-semibold",children:["$",(t.price*t.quantity).toFixed(2)]})]},t.id))}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-300 flex justify-between font-bold text-sm",children:[e.jsx("span",{className:"text-green-800",children:"Total Extras:"}),e.jsxs("span",{className:"text-green-800",children:["$",a.consumedExtras.reduce((t,s)=>t+s.price*s.quantity,0).toFixed(2)]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 overflow-y-auto mb-4",children:A.map(t=>{var r;const s=((r=a.consumedExtras.find(i=>i.id===t.id))==null?void 0:r.quantity)||0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center flex flex-col relative",children:[s>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center",children:s}),e.jsx("img",{src:t.imageUrl,alt:t.name,className:"h-16 w-16 mx-auto rounded-lg object-cover mb-2"}),e.jsx("p",{className:"text-xs font-semibold",children:t.name}),e.jsxs("p",{className:"text-xs mb-2",children:["$",t.price.toFixed(2)]}),e.jsxs("button",{onClick:()=>M(t),className:"mt-auto px-2 py-1 bg-zinc-900 text-white rounded-lg text-xs font-semibold hover:bg-zinc-700 transition-colors flex items-center justify-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"Agregar"]})]},t.id)})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>N(null),className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-xl text-sm font-medium text-slate-800",children:"Cerrar"})})]})})]})},P=({session:n,onClose:c,onConfirm:u})=>{const{cost:d,minutes:f}=D(n.startTime,new Date().toISOString()),l=n.consumedExtras.reduce((m,g)=>m+g.price*g.quantity,0),x=d+l,j=x,[o,b]=h.useState("Efectivo");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Finalizar Sesión"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-600 mb-4",children:n.clientName}),e.jsxs("div",{className:"space-y-1 text-sm border-t border-b py-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-500",children:["Tiempo de Coworking (",f," min):"]})," ",e.jsxs("span",{className:"font-medium",children:["$",d.toFixed(2)]})]}),l>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Extras consumidos:"})," ",e.jsxs("span",{className:"font-medium",children:["$",l.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Subtotal:"})," ",e.jsxs("span",{className:"font-medium",children:["$",x.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold pt-2 my-2",children:[e.jsx("span",{className:"text-slate-800",children:"Total:"})," ",e.jsxs("span",{children:["$",j.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Método de Pago"}),e.jsxs("select",{value:o,onChange:m=>b(m.target.value),className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-1.5 px-2 sm:text-sm",children:[e.jsx("option",{children:"Efectivo"}),e.jsx("option",{children:"Tarjeta"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-white border border-slate-300 rounded-xl text-sm font-medium text-slate-700",children:"Cancelar"}),e.jsx("button",{onClick:()=>{u(n.id,o),c()},className:"px-4 py-2 bg-green-500 rounded-xl text-sm font-medium text-white",children:"Confirmar Pago"})]})]})})};export{B as default};
