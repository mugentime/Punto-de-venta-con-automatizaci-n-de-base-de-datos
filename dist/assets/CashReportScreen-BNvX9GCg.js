import{u as oe,r as u,j as e,D as H,C as g,S as k,E as R,H as T,b as ce}from"./index-CecK8F-0.js";import{d as de,S as i}from"./deduplication-CNSci7KQ.js";const xe=({isOpen:p,onClose:r,onStart:m})=>{const[a,o]=u.useState(""),d=()=>{const n=parseFloat(a);!isNaN(n)&&n>=0?(m(n),r()):alert("Por favor, ingrese un monto válido.")};return p?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Iniciar Día"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Ingrese la cantidad de efectivo inicial en la caja."}),e.jsx("input",{type:"number",value:a,onChange:n=>o(n.target.value),placeholder:"Ej: 300.00",className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-white border border-slate-300 rounded-xl text-sm font-medium text-slate-700",children:"Cancelar"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-zinc-900 rounded-xl text-sm font-medium text-white",children:"Iniciar"})]})]})}):null},me=({isOpen:p,onClose:r,onWithdraw:m})=>{const[a,o]=u.useState(""),[d,n]=u.useState(""),x=()=>{const c=parseFloat(a);!isNaN(c)&&c>0&&d.trim()?(m(c,d),o(""),n(""),r()):alert("Por favor, ingrese un monto válido y una descripción.")};return p?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Retiro de Efectivo"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Registre el retiro de efectivo de la caja."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Monto a Retirar"}),e.jsx("input",{type:"number",value:a,onChange:c=>o(c.target.value),placeholder:"Ej: 500.00",className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm",autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Motivo del Retiro"}),e.jsx("textarea",{value:d,onChange:c=>n(c.target.value),placeholder:"Ej: Pago a proveedor, cambio de billetes, etc.",className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-white border border-slate-300 rounded-xl text-sm font-medium text-slate-700",children:"Cancelar"}),e.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 rounded-xl text-sm font-medium text-white",children:"Confirmar Retiro"})]})]})}):null},he=({isOpen:p,onClose:r,onConfirm:m,sessionData:a})=>{const[o,d]=u.useState(""),n=a.startAmount+a.cashSales-a.cashExpenses-a.cashWithdrawals,x=parseFloat(o)-n,c=()=>{const h=parseFloat(o);!isNaN(h)&&h>=0?(m(h),r()):alert("Por favor, ingrese un monto contado válido.")};return p?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Cierre de Caja"}),e.jsxs("div",{className:"space-y-2 text-sm border-t border-b py-3 my-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Efectivo Inicial:"})," ",e.jsxs("span",{className:"font-medium",children:["$",a.startAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"(+) Ventas en Efectivo:"})," ",e.jsxs("span",{className:"font-medium text-green-600",children:["$",a.cashSales.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"(-) Gastos:"})," ",e.jsxs("span",{className:"font-medium text-red-600",children:["$",a.cashExpenses.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"(-) Retiros de Efectivo:"})," ",e.jsxs("span",{className:"font-medium text-orange-600",children:["$",a.cashWithdrawals.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-slate-800",children:"Efectivo Esperado:"})," ",e.jsxs("span",{children:["$",n.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Efectivo Contado"}),e.jsx("input",{type:"number",value:o,onChange:h=>d(h.target.value),placeholder:"Monto final en caja",className:"mt-1 block w-full border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm"})]}),!isNaN(x)&&e.jsxs("div",{className:`mt-2 text-sm font-bold flex justify-between p-2 rounded-lg ${x===0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{children:"Diferencia:"}),e.jsxs("span",{children:["$",x.toFixed(2)," ",x>0?"(Sobrante)":x<0?"(Faltante)":""]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-white border border-slate-300 rounded-xl text-sm font-medium text-slate-700",children:"Cancelar"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-zinc-900 rounded-xl text-sm font-medium text-white",children:"Confirmar y Cerrar"})]})]})}):null},fe=()=>{const{orders:p,expenses:r,cashSessions:m,cashWithdrawals:a,coworkingSessions:o,startCashSession:d,closeCashSession:n,addCashWithdrawal:x}=oe(),[c,h]=u.useState(!1),[V,D]=u.useState(!1),[P,A]=u.useState(!1),[f,L]=u.useState(new Date().toISOString().split("T")[0]),M=de(p),l=m.find(t=>t.status==="open"),w=l?M.filter(t=>new Date(t.date)>=new Date(l.startDate)):[],G=l?r.filter(t=>new Date(t.date)>=new Date(l.startDate)):[],N=l?o.filter(t=>t.status==="finished"&&t.endTime&&new Date(t.endTime)>=new Date(l.startDate)):[],X=w.reduce((t,s)=>t+s.total,0),_=N.reduce((t,s)=>t+(s.total||0),0),B=X+_,v=G.reduce((t,s)=>t+s.amount,0),q=w.filter(t=>t.paymentMethod==="Efectivo").reduce((t,s)=>t+s.total,0),J=N.filter(t=>t.paymentMethod==="Efectivo").reduce((t,s)=>t+(s.total||0),0),j=q+J,y=l?a.filter(t=>t.cash_session_id===l.id):[],C=y.reduce((t,s)=>t+s.amount,0),K=B-j,Q=w.length+N.length,U=l?l.startAmount+j-v-C:0,Y=async(t,s)=>{if(l)try{await x(l.id,t,s)}catch(b){console.error("Error adding withdrawal:",b)}};if(l)return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Caja Activa"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Día iniciado a las ",new Date(l.startDate).toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-xl shadow-sm hover:bg-blue-700 transition-colors font-semibold",children:"Retirar Efectivo"}),e.jsx("button",{onClick:()=>D(!0),className:"px-4 py-2 bg-red-600 text-white rounded-xl shadow-sm hover:bg-red-700 transition-colors font-semibold",children:"Cerrar Caja"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(i,{title:"Efectivo Inicial",value:`$${l.startAmount.toFixed(2)}`,icon:e.jsx(H,{className:"h-6 w-6 text-gray-500"})}),e.jsx(i,{title:"Ventas en Efectivo",value:`$${j.toFixed(2)}`,icon:e.jsx(g,{className:"h-6 w-6 text-green-600"})}),e.jsx(i,{title:"Ventas con Tarjeta",value:`$${K.toFixed(2)}`,icon:e.jsx(k,{className:"h-6 w-6 text-purple-600"})}),e.jsx(i,{title:"Gastos",value:`$${v.toFixed(2)}`,icon:e.jsx(R,{className:"h-6 w-6 text-red-600"})}),e.jsx(i,{title:"Retiros de Efectivo",value:`$${C.toFixed(2)}`,icon:e.jsx(g,{className:"h-6 w-6 text-orange-600"})}),e.jsx(i,{title:"Total de Órdenes",value:Q.toString(),icon:e.jsx(T,{className:"h-6 w-6 text-yellow-600"})}),e.jsx(i,{title:"Efectivo Esperado",value:`$${U.toFixed(2)}`,icon:e.jsx(g,{className:"h-6 w-6 text-blue-600"})})]}),y.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:"Retiros de Efectivo"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Hora"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase",children:"Monto"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-700",children:new Date(t.withdrawn_at).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:t.description}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-orange-600",children:["$",t.amount.toFixed(2)]})]},t.id))})]})})]}),e.jsx(me,{isOpen:P,onClose:()=>A(!1),onWithdraw:Y}),e.jsx(he,{isOpen:V,onClose:()=>D(!1),onConfirm:n,sessionData:{startAmount:l.startAmount,cashSales:j,cashExpenses:v,cashWithdrawals:C}})]});const Z=t=>{L(t.target.value)},S=M.filter(t=>t.date&&t.date.startsWith(f)),ee=r.filter(t=>t.date&&t.date.startsWith(f)),E=o.filter(t=>t.status==="finished"&&t.endTime&&t.endTime.startsWith(f)),te=S.reduce((t,s)=>t+s.total,0),se=E.reduce((t,s)=>t+(s.total||0),0),$=te+se,I=ee.reduce((t,s)=>t+s.amount,0),ae=$-I,le=S.filter(t=>t.paymentMethod==="Efectivo").reduce((t,s)=>t+s.total,0),ne=E.filter(t=>t.paymentMethod==="Efectivo").reduce((t,s)=>t+(s.total||0),0),z=le+ne,ie=$-z,re=S.length+E.length,F=m.filter(t=>t.status==="closed").sort((t,s)=>new Date(s.endDate||s.startDate).getTime()-new Date(t.endDate||t.startDate).getTime());return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"Reporte de Caja"}),e.jsx("p",{className:"text-slate-600",children:"No hay una sesión de caja activa. Viendo reporte histórico."})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-xl shadow-sm hover:bg-green-700 transition-colors font-semibold",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Iniciar Día"]})]}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("input",{type:"date",value:f,onChange:Z,className:"bg-white border border-slate-300 rounded-xl shadow-sm py-2 px-3 focus:outline-none focus:ring-zinc-500 focus:border-zinc-500 sm:text-sm"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(i,{title:"Ventas Totales",value:`$${$.toFixed(2)}`,icon:e.jsx(H,{className:"h-6 w-6 text-green-600"})}),e.jsx(i,{title:"Gastos del Día",value:`$${I.toFixed(2)}`,icon:e.jsx(R,{className:"h-6 w-6 text-red-600"})}),e.jsx(i,{title:"Balance Final",value:`$${ae.toFixed(2)}`,icon:e.jsx(k,{className:"h-6 w-6 text-blue-600"})}),e.jsx(i,{title:"Ventas en Efectivo",value:`$${z.toFixed(2)}`,icon:e.jsx(g,{className:"h-6 w-6 text-cyan-600"})}),e.jsx(i,{title:"Ventas con Tarjeta",value:`$${ie.toFixed(2)}`,icon:e.jsx(k,{className:"h-6 w-6 text-purple-600"})}),e.jsx(i,{title:"Total de Órdenes",value:re.toString(),icon:e.jsx(T,{className:"h-6 w-6 text-yellow-600"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:["Historial de Cortes de Caja",e.jsxs("span",{className:"text-sm font-normal text-slate-500 ml-2",children:["(",F.length," registros)"]})]}),F.length>0?e.jsx("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto border border-slate-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Fecha Apertura"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Fecha Cierre"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Inicial"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Final"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Esperado"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider bg-slate-50",children:"Diferencia"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:F.map(t=>{var b,O,W;const s=t.endAmount?t.endAmount-(t.expectedCash||t.startAmount):0;return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-700",children:new Date(t.startDate).toLocaleString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-700",children:t.endDate?new Date(t.endDate).toLocaleString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-slate-900",children:["$",((b=t.startAmount)==null?void 0:b.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-slate-900",children:["$",((O=t.endAmount)==null?void 0:O.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-slate-600",children:["$",((W=t.expectedCash||t.startAmount)==null?void 0:W.toFixed(2))||"0.00"]}),e.jsxs("td",{className:`px-4 py-3 whitespace-nowrap text-sm text-right font-bold ${s===0?"text-green-600":s>0?"text-blue-600":"text-red-600"}`,children:["$",s.toFixed(2),s>0&&e.jsx("span",{className:"text-xs ml-1",children:"(Sobra)"}),s<0&&e.jsx("span",{className:"text-xs ml-1",children:"(Falta)"})]})]},t.id)})})]})}):e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No hay sesiones de caja cerradas en el historial."})]}),e.jsx(xe,{isOpen:c,onClose:()=>h(!1),onStart:d})]})};export{fe as default};
