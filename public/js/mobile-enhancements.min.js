function setVHProperty(){const vh = window.innerHeight * 0.01;document.documentElement.style.setProperty('--vh-actual',`${vh}px`);document.documentElement.classList.add('js-vh-fix');}setVHProperty();window.addEventListener('resize',setVHProperty);window.addEventListener('orientationchange',()=>{setTimeout(setVHProperty,100);});let touchStartY = 0;let touchEndY = 0;document.addEventListener('touchstart',function(e){touchStartY = e.changedTouches[0].screenY;},{passive:true});document.addEventListener('touchend',function(e){touchEndY = e.changedTouches[0].screenY;const swipeDistance = touchStartY - touchEndY;if(Math.abs(swipeDistance)> 50){const swipeEvent = new CustomEvent(swipeDistance > 0 ? 'swipeup':'swipedown',{detail:{distance:Math.abs(swipeDistance)}});e.target.dispatchEvent(swipeEvent);}},{passive:true});document.addEventListener('DOMContentLoaded',function(){const inputs = document.querySelectorAll('input,textarea,select');inputs.forEach(input =>{if(input.type === 'email' && !input.inputMode){input.inputMode = 'email';}if(input.type === 'tel' && !input.inputMode){input.inputMode = 'tel';}if(input.type === 'number' && !input.inputMode){input.inputMode = 'numeric';}if(input.type === 'search' && !input.inputMode){input.inputMode = 'search';}if(parseFloat(getComputedStyle(input).fontSize)< 16){input.style.fontSize = '16px';}input.addEventListener('focus',function(){this.scrollIntoView({behavior:'smooth',block:'center'});this.classList.add('input-focused');});input.addEventListener('blur',function(){this.classList.remove('input-focused');});});});document.addEventListener('DOMContentLoaded',function(){document.documentElement.classList.add('js-loaded');if('IntersectionObserver' in window){const imageObserver = new IntersectionObserver((entries)=>{entries.forEach(entry =>{if(entry.isIntersecting){const img = entry.target;if(img.dataset.src){img.src = img.dataset.src;img.removeAttribute('data-src');imageObserver.unobserve(img);}}});});document.querySelectorAll('img[data-src]').forEach(img =>{imageObserver.observe(img);});}if('requestIdleCallback' in window){requestIdleCallback(()=>{const criticalSections = ['registro','inventario-cafeteria','reportes'];criticalSections.forEach(sectionId =>{const section = document.getElementById(sectionId);if(section && !section.classList.contains('preloaded')){section.style.contentVisibility = 'auto';section.classList.add('preloaded');}});});}});let isOnlineGlobal = navigator.onLine;function updateConnectionStatus(){const statusElement = document.querySelector('.connection-status');if(statusElement){statusElement.style.background = isOnlineGlobal ? '#00ff00':'#ff4444';statusElement.title = isOnlineGlobal ? 'Conectado':'Sin conexión';}window.dispatchEvent(new CustomEvent('connectionchange',{detail:{online:isOnlineGlobal}}));}window.addEventListener('online',()=>{isOnlineGlobal = true;updateConnectionStatus();});window.addEventListener('offline',()=>{isOnlineGlobal = false;updateConnectionStatus();});window.addEventListener('error',function(e){if(window.location.hostname !== 'localhost' && false){console.error('Mobile Error:',{message:e.message,source:e.filename,line:e.lineno,column:e.colno,userAgent:navigator.userAgent,timestamp:new Date().toISOString()});}});function cleanupUnusedElements(){document.querySelectorAll('.modal-backdrop').forEach(backdrop =>{if(!backdrop.closest('.modal.show')){backdrop.remove();}});document.querySelectorAll('[data-temp="true"]').forEach(el => el.remove());if(window.gc && window.location.hostname === 'localhost'){window.gc();}}setInterval(cleanupUnusedElements,300000);let deferredPrompt;window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt = e;const installButton = document.querySelector('.install-app-btn');if(installButton){installButton.style.display = 'block';installButton.addEventListener('click',()=>{deferredPrompt.prompt();deferredPrompt.userChoice.then((choiceResult)=>{if(choiceResult.outcome === 'accepted'){console.log('PWA installed');}deferredPrompt = null;installButton.style.display = 'none';});});}});window.MobileEnhancements ={setVHProperty,updateConnectionStatus,cleanupUnusedElements};console.log('✅ Mobile enhancements loaded successfully');